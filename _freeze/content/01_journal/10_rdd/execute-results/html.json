{
  "hash": "8136ba97623b3af1ab0d2bc972b6831d",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\n---\n\n\n\n\n# 1\nFor the first assignment, use the data from the just discussed application (coupon.rds). When conducting a regression discontinuity design, one parameter that is chosen somehow arbitrarily is the bandwidth. Check how sensitive the result is to changing the bandwidth by running the analysis\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_b272f70e51a6dba07d8248160f764003'}\n\n```{.r .cell-code}\n# reading the RDS file and print summary\ndf <- readRDS(\"../data/coupon.rds\")\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  days_since_last  days_since_last_centered   coupon        purchase_after   \n#>  Min.   :  1.00   Min.   :-59.00           Mode :logical   Min.   :-0.8649  \n#>  1st Qu.: 14.07   1st Qu.:-45.92           FALSE:3854      1st Qu.:10.3311  \n#>  Median : 30.60   Median :-29.40           TRUE :1146      Median :13.3817  \n#>  Mean   : 39.72   Mean   :-20.28                           Mean   :14.4752  \n#>  3rd Qu.: 57.10   3rd Qu.: -2.90                           3rd Qu.:18.3075  \n#>  Max.   :210.00   Max.   :150.00                           Max.   :46.7593\n```\n:::\n:::\n\n\n## with half the bandwidth\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-3_e8eeac513e7c73f2fcd5f10a2f105eea'}\n\n```{.r .cell-code}\nc0 <- 60\nhalf_bw <- c0 + c(-2.5, 2.5)\n\n# Subsets below and above threshold in specified half-bandwidth\ndf_half_bw_below <- df %>% filter(days_since_last >= half_bw[1] & days_since_last < c0)\ndf_half_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= half_bw[2])\n\ndf_half_bw <- bind_rows(df_half_bw_above, df_half_bw_below)\ndim(df_half_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 181   4\n```\n:::\n\n```{.r .cell-code}\nmodel_half_bw_below <- lm(purchase_after ~ days_since_last, df_half_bw_below)\nmodel_half_bw_above <- lm(purchase_after ~ days_since_last, df_half_bw_above)\n\ny0 <- predict(model_half_bw_below, tibble(days_since_last = c0))\ny1 <- predict(model_half_bw_above, tibble(days_since_last = c0))\n\nlate <- y1 - y0\nsprintf(\"LATE: %.2f\", late)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE: 7.36\"\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-4_0894bb64742f4704f507da0a5e23653a'}\n\n```{.r .cell-code}\nlm_half_bw <- lm(purchase_after ~ days_since_last_centered + coupon, df_half_bw)\nsummary(lm_half_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_half_bw)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -10.9680  -2.2013   0.1676   2.1516   8.2567 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               11.6612     0.5747  20.292  < 2e-16 ***\n#> days_since_last_centered   0.6883     0.3219   2.138   0.0339 *  \n#> couponTRUE                 7.1679     1.0172   7.047 3.87e-11 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.289 on 178 degrees of freedom\n#> Multiple R-squared:  0.6622,\tAdjusted R-squared:  0.6584 \n#> F-statistic: 174.5 on 2 and 178 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## with double the bandwidth\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-5_1ddc8ef8cef4077fc9d31dd1064e2983'}\n\n```{.r .cell-code}\nc0 <- 60\ndouble_bw <- c0 + c(-10, 10)\n\n# Subsets below and above threshold in specified double-bandwidth\ndf_double_bw_below <- df %>% filter(days_since_last >= double_bw[1] & days_since_last < c0)\ndf_double_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= double_bw[2])\n\ndf_double_bw <- bind_rows(df_double_bw_above, df_double_bw_below)\ndim(df_double_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 629   4\n```\n:::\n\n```{.r .cell-code}\nmodel_double_bw_below <- lm(purchase_after ~ days_since_last, df_double_bw_below)\nmodel_double_bw_above <- lm(purchase_after ~ days_since_last, df_double_bw_above)\n\ny0 <- predict(model_double_bw_below, tibble(days_since_last = c0))\ny1 <- predict(model_double_bw_above, tibble(days_since_last = c0))\n\nlate <- y1 - y0\nsprintf(\"LATE: %.2f\", late)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE: 9.51\"\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-6_5a5c9b9ce548fb870b96179cad05b068'}\n\n```{.r .cell-code}\nlm_double_bw <- lm(purchase_after ~ days_since_last_centered + coupon, df_double_bw)\nsummary(lm_double_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_double_bw)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -12.2718  -2.0858  -0.0003   2.0275  10.6749 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)              10.61700    0.27386  38.767   <2e-16 ***\n#> days_since_last_centered  0.01413    0.04255   0.332     0.74    \n#> couponTRUE                9.51584    0.48628  19.569   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.115 on 626 degrees of freedom\n#> Multiple R-squared:  0.7052,\tAdjusted R-squared:  0.7042 \n#> F-statistic: 748.6 on 2 and 626 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nThe number of observation units reduces to almost half in number with half of the bandwidth, whereas, number of units almost doubles when we use twice of the bandwidth.\n\n# 2\nNow consider a different past campaign. For a limited amount of time, for purchases with a total amount of more than 30€ you offered free shipping. The data can be seen in shipping.rds. Have a look at the variable purchase_amount and argue whether it could generally be used as a running variable with a cut-off at 30€.\n\nUse a plot to confirm your argument.\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-7_cdd6c37dff873d254d5bc58fb6aa9073'}\n\n```{.r .cell-code}\n# reading the RDS file and print summary\ndf <- readRDS(\"../data/shipping.rds\")\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  purchase_amount \n#>  Min.   :  1.00  \n#>  1st Qu.: 13.75  \n#>  Median : 31.94  \n#>  Mean   : 35.06  \n#>  3rd Qu.: 49.59  \n#>  Max.   :150.00\n```\n:::\n\n```{.r .cell-code}\n# consider 30 as cut-off and add a Boolean for free-shipping\nc0 <- 30\ndf <- df %>% mutate(free_shipping = ifelse(purchase_amount > c0, TRUE, FALSE))\n```\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-8_70eb6f723f9658d6946aaf35e5d6ac50'}\n\n```{.r .cell-code}\n# Scatter plot shows the availability of units before and after the cutoff line of 30\n\nggplot(df, aes(x = purchase_amount, y = free_shipping, color = free_shipping)) +\n  geom_point(alpha = 0.2, position = position_jitter()) +\n  guides(scale = \"none\") +\n  scale_y_discrete(labels = c(\"No free shipping\", \"Free shipping\"))+\n  scale_color_discrete(labels = c(\"No free shippinng\", \"Free shipping\")) +\n  xlab(\"Purchase amount\") +\n  ylab(\"\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-9_3d0ca6138f3a245ca323f0cfa7e7aeab'}\n\n```{.r .cell-code}\n# To confirm no heaping at cut-off, plot histogram\n# As a sudden change can be seen after cutoff, therefore\n# continuity assumption does not hold.\n\n  ggplot(df, aes(x = purchase_amount, fill = free_shipping)) +\n  geom_histogram(binwidth = 4, color = \"white\", boundary = c0, alpha = .6) +\n  scale_fill_discrete(labels = c(\"No free shippinng\", \"Free shipping\")) +\n  xlab(\"Purchase amount\") +\n  ylab(\"Number of free shippings\") +\n  theme(legend.title = element_blank())\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-10_516aa472cfacc38005a2611e4b412d45'}\n\n```{.r .cell-code}\n# To check the continuity assumption more thoroughly,\n# calculate p-value using rddensity library.\n\n# As p=0.5 is greater than arbitrary value (0.05), continuity assumption does not hold.\n\nrddd <- rddensity::rddensity(df$purchase_amount, c = c0)\nsummary(rddd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       6666\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         3088                3578                \n#> Eff. Number of obs    2221                1955                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           22.909              20.394              \n#> \n#> Method                T                   P > |T|             \n#> Robust                5.9855              0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rddd): There are repeated observations. Point\n#> estimates and standard errors have been adjusted. Use option massPoints=FALSE\n#> to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.261                      20      26    0.4614\n#> 0.522                      41      65    0.0250\n#> 0.783                      62     107    0.0007\n#> 1.043                      81     136    0.0002\n#> 1.304                     100     169    0.0000\n#> 1.565                     114     196    0.0000\n#> 1.826                     132     227    0.0000\n#> 2.087                     156     263    0.0000\n#> 2.348                     173     298    0.0000\n#> 2.609                     191     331    0.0000\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-11_2979ae52ac92c5562ade1d197f5d09ee'}\n\n```{.r .cell-code}\n# Visually check continuity at running variable\nrdd_plot <- rddensity::rdplotdensity(rddd, df$purchase_amount, plotN = 100)\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nAs continuity assumption does not hold, purchase_amount variable is not suitable to be used as a running variable.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}