{
  "hash": "b2dadca742753cd106138c3828f467ff",
  "result": {
    "markdown": "---\ntitle: \"Randomized Controlled Trials\"\n---\n\n\n\n\nLoad the dataset abtest_online.rds. It contains data about a randomized experiment run by an online shop. E-commerce websites frequently conduct numerous randomized experiments, commonly referred to as AB testing in a business context. In these experiments, a subset of randomly chosen website visitors is presented with a slightly altered version of the site, while others see the standard version. This approach enables the testing of new features, and the decision to implement a new feature is contingent on the outcomes derived from these tests.\n\nConsider this situation: You operate an online store and are concerned about the expenses associated with your customer service. To cut costs, you contemplate introducing a chatbot as a substitute for human customer service. However, you’re uncertain whether this change might have a detrimental impact on your sales. Consequently, you intend to conduct an AB test. In this test, a portion of users will be directed to a website equipped with a chatbot (treatment group), while the remaining customers will still interact with human customer service (control group) if they have questions. To ensure randomization, you’ll allocate the treatment based on the last digit of each user’s IP address.\n\nThere are two outcome variables, purchase and purchase_amount. The first one shows whether a customer bought and the other how much (in €) he bought. First, let’s use purchase_amount.\n\nOther variables included are mobile_device being TRUE when a user visits the site using a mobile device and previous_visits indicating the number of previous visits of a particular user.\n\nAfter loading the data, perform the following steps:\n\n# 1\n* Check whether the covariates are balanced across the groups. Use a plot to show it.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-2_abf0012180aa025464e31630261b1dd5'}\n\n```{.r .cell-code}\n# reading the RDS file and print summary\nonlineShopData <- readRDS(\"../data/abtest_online.rds\")\nsummary(onlineShopData)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>       ip             chatbot        previous_visit   mobile_device  \n#>  Length:1000        Mode :logical   Min.   : 0.000   Mode :logical  \n#>  Class :character   FALSE:496       1st Qu.: 1.000   FALSE:683      \n#>  Mode  :character   TRUE :504       Median : 1.000   TRUE :317      \n#>                                     Mean   : 2.021                  \n#>                                     3rd Qu.: 3.000                  \n#>                                     Max.   :13.000                  \n#>     purchase     purchase_amount\n#>  Min.   :0.000   Min.   : 0.00  \n#>  1st Qu.:0.000   1st Qu.: 0.00  \n#>  Median :0.000   Median : 0.00  \n#>  Mean   :0.381   Mean   :13.14  \n#>  3rd Qu.:1.000   3rd Qu.:27.44  \n#>  Max.   :1.000   Max.   :81.35\n```\n:::\n:::\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-3_c6e5dee6ff6c68cf914ad5143c24723a'}\n\n```{.r .cell-code}\n#  Plotting covariates to check if they are balanced across treatment and control groups\ncompare_previous_visit <- \n  ggplot(onlineShopData, \n         aes(x = chatbot, \n             y = previous_visit, \n             color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"previous_visit\", title = \"Difference in previous_visit\")\n\ncompare_mobile_device <- \n  ggplot(onlineShopData, \n         aes(x = chatbot, \n             y = mobile_device, \n             color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"mobile_device\", title = \"Difference in mobile_device\")\n\ncompare_purchase <- \n  ggplot(onlineShopData, \n         aes(x = chatbot, \n             y = purchase, \n             color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"purchase\", title = \"Difference in purchase\")\n\ncompare_purchase_amount <- \n  ggplot(onlineShopData, \n         aes(x = chatbot, \n             y = purchase_amount, \n             color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"purchase_amount\", title = \"Difference in purchase_amount\")\n\ncompare_previous_visit\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncompare_mobile_device\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\ncompare_purchase\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n```{.r .cell-code}\ncompare_purchase_amount\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-3-4.png){width=672}\n:::\n:::\n\n\nWe can also confirm that the covariates are almost balanced accross groups by calculating mean values.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-4_af3ed48d2be12cbbac488f66a20b765b'}\n\n```{.r .cell-code}\nonlineShopData %>% \n  group_by(chatbot) %>%\n  summarise(\n    mean_previous_visit = mean(previous_visit),\n    mean_mobile_device = mean(mobile_device),\n    mean_purchase = mean(purchase),\n    mean_purchase_amount = mean(purchase_amount)\n    )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"chatbot\"],\"name\":[1],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"mean_previous_visit\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mean_mobile_device\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mean_purchase\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mean_purchase_amount\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"FALSE\",\"2\":\"2.169355\",\"3\":\"0.3185484\",\"4\":\"0.4959677\",\"5\":\"16.701681\"},{\"1\":\"TRUE\",\"2\":\"1.875000\",\"3\":\"0.3154762\",\"4\":\"0.2678571\",\"5\":\"9.626129\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n# 2\n* Run a regression to find the effect of chatbot on sales.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-5_87a12aa313527bf1216dfaf79ede5307'}\n\n```{.r .cell-code}\nm1 = lm(purchase_amount ~ chatbot, data = onlineShopData)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot, data = onlineShopData)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -16.702 -14.478  -9.626  13.922  64.648 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  16.7017     0.8374  19.944  < 2e-16 ***\n#> chatbotTRUE  -7.0756     1.1796  -5.998 2.79e-09 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.65 on 998 degrees of freedom\n#> Multiple R-squared:  0.0348,\tAdjusted R-squared:  0.03383 \n#> F-statistic: 35.98 on 1 and 998 DF,  p-value: 2.787e-09\n```\n:::\n:::\n\n\nWe can also include other covariates in our regression model.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-6_58ccf24029f87a81035c82db585f3cd5'}\n\n```{.r .cell-code}\nm2 = lm(purchase_amount ~ chatbot + previous_visit + mobile_device, data = onlineShopData)\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot + previous_visit + mobile_device, \n#>     data = onlineShopData)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -25.414 -14.428  -8.435  12.559  64.584 \n#> \n#> Coefficients:\n#>                   Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)        15.2840     1.1227  13.614  < 2e-16 ***\n#> chatbotTRUE        -6.8488     1.1792  -5.808 8.49e-09 ***\n#> previous_visit      0.7792     0.2869   2.716  0.00673 ** \n#> mobile_deviceTRUE  -0.8562     1.2642  -0.677  0.49841    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.6 on 996 degrees of freedom\n#> Multiple R-squared:  0.04243,\tAdjusted R-squared:  0.03954 \n#> F-statistic: 14.71 on 3 and 996 DF,  p-value: 2.228e-09\n```\n:::\n:::\n\n\n# 3\n* Find subgroup-specific effects by including an interaction. Compute a CATE for one exemplary group. A subgroup could be for example mobile users.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-7_a658abb6bd536d00801d527f4ddaf939'}\n\n```{.r .cell-code}\nm3 = lm(purchase_amount ~ chatbot * previous_visit + chatbot * mobile_device, data = onlineShopData)\nsummary(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot * previous_visit + chatbot * \n#>     mobile_device, data = onlineShopData)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -22.057 -15.928  -7.419  12.804  65.333 \n#> \n#> Coefficients:\n#>                               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)                    17.2052     1.2982  13.253  < 2e-16 ***\n#> chatbotTRUE                   -11.1064     1.8434  -6.025 2.38e-09 ***\n#> previous_visit                 -0.1030     0.3749  -0.275 0.783562    \n#> mobile_deviceTRUE              -0.8791     1.7823  -0.493 0.621943    \n#> chatbotTRUE:previous_visit      2.0978     0.5781   3.629 0.000299 ***\n#> chatbotTRUE:mobile_deviceTRUE   0.2044     2.5148   0.081 0.935229    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.49 on 994 degrees of freedom\n#> Multiple R-squared:  0.05495,\tAdjusted R-squared:  0.0502 \n#> F-statistic: 11.56 on 5 and 994 DF,  p-value: 7.177e-11\n```\n:::\n:::\n\n\nCATE for chatbot and previous_visit subgroup is being calculated.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-8_28644f4b522c81438e3b60cf8dcf1120'}\n\n```{.r .cell-code}\n# CATE(chatbot, previous_visit) = Intercept+chatbotTRUE+chatbotTRUE:previous_visit\ncate <- 17.2052 - 11.1064 + 2.0978\ncate\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 8.1966\n```\n:::\n:::\n\n\n# 4\n* It’s not only of interest how much customers buy but also if the buy at all. Then, the dependent variable is binary (either 0 or 1) instead of continuous and the model of choice is the logistic regression. Use the outcome variable purchase and run a logistic regression. The coefficients are not as easily interpretable as before. Look it up and interpret the coefficient for chatbot.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-9_e01fcb62a91b256fba728ba7dd746fe8'}\n\n```{.r .cell-code}\nm4 = glm(purchase ~ chatbot, family=binomial(link='logit'), onlineShopData)\nsummary(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> glm(formula = purchase ~ chatbot, family = binomial(link = \"logit\"), \n#>     data = onlineShopData)\n#> \n#> Coefficients:\n#>             Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept) -0.01613    0.08981  -0.180    0.857    \n#> chatbotTRUE -0.98939    0.13484  -7.337 2.18e-13 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 1329.1  on 999  degrees of freedom\n#> Residual deviance: 1273.3  on 998  degrees of freedom\n#> AIC: 1277.3\n#> \n#> Number of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\nThe estimate for chatbot is negative, which represents that having the chatbot is associated with a decrease in the log-odds of making a purchase. A decrease in log odds suggests a decrease in the likelihood of the event (purchase all).",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}