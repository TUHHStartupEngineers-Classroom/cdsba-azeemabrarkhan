{
  "hash": "70d9ec63cf8bd5e464648b32c503a212",
  "result": {
    "markdown": "---\ntitle: \"Directed Acyclic Graphs\"\n---\n\n\n\n\n# 1\n* Think about example from previous chapter (parking spots) and draw the DAG.\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-2_38ca05a4615a32cfe7327462e34e2062'}\n\n```{.r .cell-code}\n# Z = location of the store\n# D = No. of parking spots as exposure\n# Y = Sales\n\ndag_model <- 'dag {\nbb=\"0,0,1,1\"\nZ [pos=\"0.5,0.5\"]\nD [exposure,pos=\"0,0\"]\nY [outcome,pos=\"1,0\"]\nZ -> D\nZ -> Y\nD -> Y\n}\n'\n# draw DAG\nggdag_status(dag_model) +\n  theme_dag_gray()+\n  geom_dag_edges(edge_color = \"black\")\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\nZ = Location of the store  \nD = No. of parking spots as an exposure  \nY = Sales as an outcome  \n\nThe location of the store can effect both the number of available parking spots and sales. Stores in the city center might be subjected to more sales but with no parking spots, whereas, stores outside the city center might have low sales but with available parking spots. Location is acting as a confounder here.\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-3_74e9d64d74fea1ffa076ada15681fefb'}\n\n```{.r .cell-code}\n# find all paths\npaths(dag_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> $paths\n#> [1] \"D -> Y\"      \"D <- Z -> Y\"\n#> \n#> $open\n#> [1] TRUE TRUE\n```\n:::\n:::\n\nThere are 2 paths and both are open\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-4_525083f7d1b21c02139d0de884bc2b55'}\n\n```{.r .cell-code}\n# plot individual paths\nggdag_paths(dag_model) +\n  theme_dag_gray()\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-5_8a7ae5b531d4c8825a6f0e90ec185070'}\n\n```{.r .cell-code}\n# find all nodes that need to be adjusted\nadjustmentSets(dag_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> { Z }\n```\n:::\n:::\n\nNode-Z must be adjusted as it is acting as a confounder.\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-6_20494e7ed187911fb542701e72bbfda0'}\n\n```{.r .cell-code}\nggdag_adjustment_set(dag_model, shadow = T) +\n  theme_dag_gray() +\n  geom_dag_edges(edge_color = \"black\")\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nThe adjusted node and the adjusted edges are represented in the above figure.\n\n# 2\n* Load the data file customer_sat.rds. A company sells a SaaS (Software as a service) to business clients that chose to subscribe to one of the three subscription levels, Starter, Premium or Elite, which provide different features at different price points (more storage and other capabilities). Starter has the least functionality, while Elite includes the most features. Now imagine, you are working as an analyst for that company and are asked to examine the relationship between follow-up calls to the clients and their satisfaction with the product and service. Follow-up calls are voluntary and are just to help the client with possible problems and so on. Satisfaction is measured on a weekly basis by surveying the clients. In the data, you find three variables: satisfaction, follow_ups and subscription. Perform the following steps:\n\n    + regress satisfaction on follow_ups\n\n    + regress satisfaction on follow_ups and account for subscription\n    \n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-7_a5bff0a9ec6bfce9843b095421569379'}\n\n```{.r .cell-code}\n#Load data and print summary\ncustomers <- readRDS(\"../data/customer_sat.rds\")\ncustomers$subscription <- as.factor(customers$subscription)\nsummary(customers)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    follow_ups      satisfaction     subscription\n#>  Min.   : 0.000   Min.   :40.00   Elite   :5    \n#>  1st Qu.: 2.500   1st Qu.:48.50   Premium :5    \n#>  Median : 7.000   Median :60.00   Premium+:5    \n#>  Mean   : 5.667   Mean   :60.13                 \n#>  3rd Qu.: 8.000   3rd Qu.:72.00                 \n#>  Max.   :10.000   Max.   :80.00\n```\n:::\n:::\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-8_b22f7cc06626619e4d068007b8e34fd0'}\n\n```{.r .cell-code}\n#regress satisfaction on follow_ups\ncustomer_model_limited <- lm(satisfaction ~ follow_ups, data = customers)\nsummary(customer_model_limited)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups, data = customers)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -12.412  -5.257   1.733   4.506  12.588 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  78.8860     4.2717  18.467 1.04e-10 ***\n#> follow_ups   -3.3093     0.6618  -5.001 0.000243 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 7.923 on 13 degrees of freedom\n#> Multiple R-squared:  0.658,\tAdjusted R-squared:  0.6316 \n#> F-statistic: 25.01 on 1 and 13 DF,  p-value: 0.0002427\n```\n:::\n:::\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-9_67a807990e70ced4dcab9ffb14743dff'}\n\n```{.r .cell-code}\n#regress satisfaction on follow_ups and account for subscription\ncustomer_model <- lm(satisfaction ~ ., data = customers)\nsummary(customer_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ ., data = customers)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -4.3222 -2.1972  0.3167  2.2667  3.9944 \n#> \n#> Coefficients:\n#>                      Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)           26.7667     6.6804   4.007  0.00206 ** \n#> follow_ups             2.1944     0.7795   2.815  0.01682 *  \n#> subscriptionPremium   44.7222     5.6213   7.956 6.88e-06 ***\n#> subscriptionPremium+  18.0722     2.1659   8.344 4.37e-06 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 2.958 on 11 degrees of freedom\n#> Multiple R-squared:  0.9597,\tAdjusted R-squared:  0.9487 \n#> F-statistic: 87.21 on 3 and 11 DF,  p-value: 5.956e-08\n```\n:::\n:::\n\n# 3\n* Compare the coefficients and find a possible explanation.\n\nThe estimate for the limited model is less than 0 which represents the negative correlation between the follow_ups and the satisfaction level, which seems erroneous. We need to include the subscription class as well and build the complete model.\n\nHowever, in case of complete model, all the estimates are greater than zero and shows positive correlation. In other words, the satisfaction increases with the increase in the number of follow ups.\n\n# 4\n* Plot the data. Youâ€™ll find a similar plot in this chapter, that you can copy some lines from.\n\nWe can ignore the factor variable of subscription type in the first plot while taking it into account in the second plot to compare the differences and to prove the above explanation.\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-10_11e489e3a562c8474f827c8ffc306920'}\n\n```{.r .cell-code}\ncustomers_plot_not_cond <- ggplot(customers, aes(x = follow_ups, y = satisfaction)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)\n\ncustomers_plot_cond <- ggplot(customers, aes(x = follow_ups, y = satisfaction, color = subscription)) +\n  geom_point(alpha = .8) +\n  stat_smooth(method = \"lm\", se = F)\n\ncustomers_plot_not_cond\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncustomers_plot_cond\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}