{
  "hash": "f7997e93701d1f94a466cb6185a61f69",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-Differences\"\n---\n\n\n\n\nImagine, you are manager of a large health provider that manages many hospitals and you want to test how a new admission procedure affects patient satisfaction. You randomly selected 18 hospitals that introduced the new admission procedure and compare them to 28 other hospitals that did not introduce the method. For both groups of hospitals you collected data from before and after the introduction. The data you have collected is from patient surveys where they were asked how satisfied they are.\n\nLoad the data from the file hospdd.rds1. Then, perform a difference-in-differences analysis by\n\n# 1\n* Manually computing the mean satisfaction for treated and control hospitals before and after the treatment. Helpful functions could be filter(), pull() and basic arithmetic operations.\n\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-2_957aadd2f3203d196f895efea712cd8a'}\n\n```{.r .cell-code}\n# reading the RDS file and print summary\ndf <- readRDS(\"../data/hospdd.rds\")\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>     hospital       frequency         month         procedure     \n#>  Min.   : 1.00   Min.   :1.000   Min.   :1.000   Min.   :0.0000  \n#>  1st Qu.:11.00   1st Qu.:1.000   1st Qu.:1.750   1st Qu.:0.0000  \n#>  Median :23.00   Median :2.000   Median :3.500   Median :0.0000  \n#>  Mean   :22.84   Mean   :2.473   Mean   :3.625   Mean   :0.2079  \n#>  3rd Qu.:35.00   3rd Qu.:4.000   3rd Qu.:5.250   3rd Qu.:0.0000  \n#>  Max.   :46.00   Max.   :4.000   Max.   :7.000   Max.   :1.0000  \n#>      satis       \n#>  Min.   :0.5468  \n#>  1st Qu.:2.8888  \n#>  Median :3.4975  \n#>  Mean   :3.6191  \n#>  3rd Qu.:4.2405  \n#>  Max.   :9.7129\n```\n:::\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-3_4aced2c4fc37a0e101cfb0840fa594aa'}\n\n```{.r .cell-code}\ndf <- df %>% filter(month %in% 4:5) %>% mutate(after = ifelse(month > 4, 1, 0))\n\nbefore_control <- df %>%\n  filter(procedure == 0, after == 0) %>%\n  summarise(mean_satis = mean(satis, na.rm = TRUE)) %>% \n  pull(mean_satis)\n\nbefore_treatment <- df %>%\n  filter(procedure == 1, after == 0) %>%\n  summarise(mean_satis = mean(satis, na.rm = TRUE)) %>% \n  pull(mean_satis)\n\ndiff_before <- before_treatment - before_control\n\nafter_control <- df %>%\n  filter(procedure == 0, after == 1) %>%\n  summarise(mean_satis = mean(satis, na.rm = TRUE)) %>% \n  pull(mean_satis)\n\nafter_treatment <- df %>%\n  filter(procedure == 1, after == 1) %>%\n  summarise(mean_satis = mean(satis, na.rm = TRUE)) %>% \n  pull(mean_satis)\n\ndiff_after <- after_treatment - after_control\n\ndid <- diff_after - diff_before\ndid\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.08123456\n```\n:::\n:::\n\n\n#2 \nUsing a linear regression to compute the estimate. Also, include group and time fixed effects in the regression, i.e. one regressor for each month and one regressor for each hospital: Consider, whether you want to include them as\n\nmonth + hospital or as\nas.factor(month) + as.factor(hospital)\n\nand explain what the difference is.\n\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-4_df73de162c15580557e0f2d1805703b5'}\n\n```{.r .cell-code}\nsummary(lm(satis ~ procedure*after + hospital + month, data = df))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ procedure * after + hospital + month, data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.3296 -0.6526 -0.0948  0.5550  5.3647 \n#> \n#> Coefficients:\n#>                  Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)      3.525805   0.036122  97.610  < 2e-16 ***\n#> procedure        0.839639   0.060570  13.862  < 2e-16 ***\n#> after           -0.043958   0.055555  -0.791  0.42882    \n#> hospital        -0.003640   0.001047  -3.477  0.00051 ***\n#> month            0.002050   0.012080   0.170  0.86522    \n#> procedure:after  0.069698   0.069161   1.008  0.31360    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.9836 on 7362 degrees of freedom\n#> Multiple R-squared:  0.1326,\tAdjusted R-squared:  0.132 \n#> F-statistic: 225.1 on 5 and 7362 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-5_eb55646b9193b291e169afbf07665fbc'}\n\n```{.r .cell-code}\nsummary(lm(satis ~ procedure*after + as.factor(month) + as.factor(hospital), data = df))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ procedure * after + as.factor(month) + as.factor(hospital), \n#>     data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.1880 -0.4648  0.0047  0.4545  4.3181 \n#> \n#> Coefficients: (1 not defined because of singularities)\n#>                         Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)            3.1716566  0.0562202  56.415  < 2e-16 ***\n#> procedure              0.8034337  0.0541047  14.850  < 2e-16 ***\n#> after                 -0.0173701  0.0330085  -0.526 0.598743    \n#> as.factor(month)2     -0.0096077  0.0292117  -0.329 0.742242    \n#> as.factor(month)3      0.0219686  0.0292117   0.752 0.452046    \n#> as.factor(month)4      0.0152441  0.0368721   0.413 0.679303    \n#> as.factor(month)5      0.0017914  0.0337307   0.053 0.957646    \n#> as.factor(month)6      0.0073566  0.0337307   0.218 0.827359    \n#> as.factor(month)7             NA         NA      NA       NA    \n#> as.factor(hospital)2   0.4085664  0.0772411   5.289 1.26e-07 ***\n#> as.factor(hospital)3   0.5336248  0.0793377   6.726 1.88e-11 ***\n#> as.factor(hospital)4   0.2275102  0.0739405   3.077 0.002099 ** \n#> as.factor(hospital)5  -0.1453529  0.0739405  -1.966 0.049358 *  \n#> as.factor(hospital)6   0.4478634  0.0739405   6.057 1.45e-09 ***\n#> as.factor(hospital)7   1.4044164  0.0714553  19.654  < 2e-16 ***\n#> as.factor(hospital)8   0.0718758  0.0763179   0.942 0.346329    \n#> as.factor(hospital)9  -1.5185150  0.0782440 -19.407  < 2e-16 ***\n#> as.factor(hospital)10  1.6828446  0.0772411  21.787  < 2e-16 ***\n#> as.factor(hospital)11  0.2209653  0.0763179   2.895 0.003799 ** \n#> as.factor(hospital)12 -0.0953034  0.0782440  -1.218 0.223252    \n#> as.factor(hospital)13  0.4955931  0.0754652   6.567 5.48e-11 ***\n#> as.factor(hospital)14  0.2330426  0.0793377   2.937 0.003321 ** \n#> as.factor(hospital)15 -0.1444935  0.0793377  -1.821 0.068610 .  \n#> as.factor(hospital)16  1.4142680  0.0772411  18.310  < 2e-16 ***\n#> as.factor(hospital)17  0.4235429  0.0805355   5.259 1.49e-07 ***\n#> as.factor(hospital)18  0.1532761  0.0938155   1.634 0.102343    \n#> as.factor(hospital)19 -0.7453017  0.0811615  -9.183  < 2e-16 ***\n#> as.factor(hospital)20  0.0473874  0.0791133   0.599 0.549204    \n#> as.factor(hospital)21  1.1943370  0.0836225  14.282  < 2e-16 ***\n#> as.factor(hospital)22  0.7993153  0.0823328   9.708  < 2e-16 ***\n#> as.factor(hospital)23  0.7017202  0.0811615   8.646  < 2e-16 ***\n#> as.factor(hospital)24 -0.3081260  0.0866394  -3.556 0.000378 ***\n#> as.factor(hospital)25  0.6464736  0.0927250   6.972 3.40e-12 ***\n#> as.factor(hospital)26  0.2142471  0.0791133   2.708 0.006783 ** \n#> as.factor(hospital)27 -0.3986544  0.0766099  -5.204 2.01e-07 ***\n#> as.factor(hospital)28  0.7119953  0.0836225   8.514  < 2e-16 ***\n#> as.factor(hospital)29  0.2485512  0.0800927   3.103 0.001921 ** \n#> as.factor(hospital)30 -0.1679220  0.0953629  -1.761 0.078302 .  \n#> as.factor(hospital)31  0.5120848  0.0791133   6.473 1.02e-10 ***\n#> as.factor(hospital)32 -0.3233456  0.0800927  -4.037 5.47e-05 ***\n#> as.factor(hospital)33 -0.4539752  0.0791133  -5.738 9.95e-09 ***\n#> as.factor(hospital)34 -0.0004123  0.0746048  -0.006 0.995590    \n#> as.factor(hospital)35  0.3541110  0.0766099   4.622 3.86e-06 ***\n#> as.factor(hospital)36  2.1381425  0.0773804  27.632  < 2e-16 ***\n#> as.factor(hospital)37  0.1404036  0.0927250   1.514 0.130020    \n#> as.factor(hospital)38 -0.0868060  0.0782122  -1.110 0.267089    \n#> as.factor(hospital)39 -0.0234969  0.0823328  -0.285 0.775354    \n#> as.factor(hospital)40  1.1215331  0.0782122  14.340  < 2e-16 ***\n#> as.factor(hospital)41 -0.1497346  0.0766099  -1.955 0.050679 .  \n#> as.factor(hospital)42  0.8811369  0.0850500  10.360  < 2e-16 ***\n#> as.factor(hospital)43 -0.7724325  0.0811615  -9.517  < 2e-16 ***\n#> as.factor(hospital)44  0.0344120  0.0904329   0.381 0.703566    \n#> as.factor(hospital)45 -0.2137495  0.0766099  -2.790 0.005283 ** \n#> as.factor(hospital)46  0.0784915  0.0823328   0.953 0.340448    \n#> procedure:after        0.0594055  0.0558791   1.063 0.287768    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.7238 on 7314 degrees of freedom\n#> Multiple R-squared:  0.5333,\tAdjusted R-squared:  0.5299 \n#> F-statistic: 157.7 on 53 and 7314 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nWhen the hospital id and month are added as factors we get individual estimates for every month and hospital, whereas, when they are added normally, they are treated as numeric values and could produce erroneous results.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}